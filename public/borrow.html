<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-dark text-white" >
        <div class="container-fluid">
            <a class="navbar-brand logo text-primary" href="#">DIGITAL LIBRARY</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" 
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon" style="background-image: url('data:image/svg+xml;charset=UTF8,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 30 30%27 fill=%27white%27><path stroke=%27rgba(255, 255, 255, 1)%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-miterlimit=%2710%27 d=%27M4 7h22M4 15h22M4 23h22%27/></svg>');"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link text-white" aria-current="page" href="http://localhost:3000/home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="http://localhost:3000/about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="http://localhost:3000/contact">Contact</a>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Browse
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="http://localhost:3000/trending">Trending</a></li>
                            <li><a class="dropdown-item" href="http://localhost:3000/random">Random</a></li>
                          
                        </ul>
                    </li>
                </ul>
                
    
                    <button class="btn btn-outline-primary" type="submit"><a href="http://localhost:3000/search" id="search">Search</a></button>
                    <button class="btn btn-outline-primary" id="logout" type="submit">Logout</button>
               
            </div>
        </div>
    </nav>
    <div class="main-container">
        <div class="main">
            <div class="banner">Borrow Books</div>
            <div class="Details">
                <div class="container-img">
                    <div class="image-wrapper" onmousemove="zoomImage(event)" onmouseout="resetZoom()">
                        <img id="book-image" src="" alt="Book Image" width="200" />
                        <div class="zoom-circle"></div>
                    </div>
                </div>
                <div class="book-details">
                    <h4 id="book-title"></h4>
                    <p>Author: <span id="book-author"></span></p>
                    <p>Genre: <span id="book-genre"></span></p>
                    <p>Publication Year: <span id="book-year"></span></p>
                    <p>Rack: <span id="book-rack"></span></p>
                    <p>Shelf: <span id="book-shelf"></span></p>
                    <form id="borrow-form">
                        <input type="hidden" id="book-id" />
                        <label for="borrower-name">Your Name:</label>
                        <input type="text" id="borrower-name" required />
                        <br>
                        <br>
                        
                        <label for="borrow-date">Borrow Date:</label>
                        <input type="date" id="borrow-date" required />
                        
                        <label for="due-date">Due Date:</label>
                        <input type="date" id="due-date" required />
                        
                        
                        
                        <button type="submit" class="borrow-btn">Borrow</button>
                        <a href="#" class="btn btn-secondary mt-3" data-bs-toggle="modal" data-bs-target="#borrowHistoryModal">
                            Check Borrow History...
                        </a>
                    
                        <!-- Modal -->
                        <div class="modal fade" id="borrowHistoryModal" tabindex="-1" aria-labelledby="borrowHistoryLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="borrowHistoryLabel">Borrow History</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Input Section -->
                                        <div id="username-input-section" class="text-center mb-3">
                                            <input type="text" id="username" class="form-control mb-2" placeholder="Enter Student Name">
                                            <button id="fetch-history-btn" class="btn btn-primary">Fetch History</button>
                                        </div>
                                        <!-- Borrow History Grid -->
                                        <div id="borrow-history-container" class="parent">
                                            <!-- History Cards will be dynamically added here -->
                                        </div>
                                        <p id="no-data-message" class="text-center text-danger mt-3" style="display: none;">No borrow history found for the given student.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <br>
                    <p class="Note">
                        <span class="note-span">Note:</span> The book you borrow must be returned within the due date. Otherwise, you will be charged a fine. Ensure the book is in good condition to avoid additional penalties.
                    </p>
                </div>
                 <!-- Borrow History Button -->
    
            </div>
            <div class="space"></div>
        </div>
    </div>
 


   <style>

    .navbar{
        height: 70px;
    }
      #select-option{
    background-color: #212529;
    color: #fff;
    width: 70px;
    border: 1.5px solid #f1f0f0;

  }
  #search{
    background-color: #212529;
    color: #fff;
    margin-right: 2px;
    

  }
  #history{
    margin-left: 10px ;
    
  }
  #history{
    color: #fff;
  }
  a{
    text-decoration: none;
  }
  a:hover{
  
    color: #fff;
  }
  #search::placeholder{
    color: #fff;
  }
  s#earch-btn a{
    
    text-decoration: none;
    
  }
  #search-btn:hover{
    color: #fff;
  }

#search{
background-color: #212529;
color: #fff;
margin-right: 2px;
height: 50px;

}
#search::placeholder{
color: #fff;
}
#logout{
  margin-left: 5px;

}
#select-option{
    border-radius: 10px;
    margin-right: 5px;
    height: 50px;

}
.borrow-btn{
    width: 150px;
    background-color: #007bff;
    color: #fff;
    outline: 0;
    border: 0;
    border-radius: 5px;
}
    .main-container{
        height: 100vh;
        width: 100%;

    }
    .main{
        height: 100vh;
        width: 100%;
        padding: 30px 100px 50px 100px;

    }
    .banner{
        height: 50px;
        width: 100%;
        background-color: darkblue;
        text-align: center;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-bottom: 70px;
    }
    .Details{
        display: flex;
        height: 500px;
        border: 2px solid #000;
        gap: 150px;
        padding: 50px;
        
    }
.Note{
    font-size: 14px;
    font-style: italic;

    }
    .note-span{
        font-size: 16px;
        font-weight: 700;
    }
    .book-details{
        margin-top: 10px;
        
    }
    span{
        font-size: 12px;
        color: #252525;
    }

    .container-img {
            display: flex;
            align-items: center;
            gap: 10px; /* Adjust spacing between elements */
        }

        .image-wrapper {
            position: relative;
            width: 300px; /* Set your desired size */
            height: 400px;
            overflow: hidden;
        }
label{
    font-weight: 700;
}
form button{
    display: block;
    margin-top: 30px;
    background-color: rgb(65, 182, 228);
    color: #fff;
    padding: 5px;
    height: 40px;
    border: 1px solid #000;
    margin-bottom: 20px;
    
}
        .image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .zoom-circle {
            width: 200px; /* Circle size */
            height: 200px;
            border-radius: 50%;
            position: absolute;
            display: none; /* Initially hidden */
            border: 2px solid #000; /* Optional border for the circle */
            pointer-events: none; /* Prevent interference with cursor */
            background-size: 300%; /* Adjust zoom level */
            background-position: center;
            background-repeat: no-repeat;
            z-index: 10; /* Ensure it's above the image */
        }
        .space
        {
            height: 100px;
            width: 100%;
        }
        .parent {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .div1 {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            background-color: #f9f9f9;
            transition: transform 0.2s;
        }

        .div1:hover {
            transform: scale(1.05);
        }

        .img img {
            max-height: 150px;
            width: auto;
            margin-bottom: 10px;
        }

        .book-details h5 {
            margin: 5px 0;
        }

        .book-details p {
            margin: 2px 0;
        }

        .book-details button {
            margin-top: 10px;
        }

        /* Modal Styling */
        .modal-content {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            background-color: #007bff;
            color: #fff;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
        }

        .modal-header h5 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: bold;
        }

        .modal-body {
            padding: 20px;
        }

        #username-input-section input {
            max-width: 400px;
            margin: 0 auto;
        }

        #fetch-history-btn {
            margin-top: 10px;
            padding: 8px 16px;
            font-size: 1rem;
        }

        #no-data-message {
            font-size: 1rem;
            font-weight: bold;
        }

        @media (max-width: 576px) {
            .modal-content {
                padding: 10px;
            }

            .parent {
                grid-template-columns: 1fr;
            }

            .div1 {
                padding: 10px;
            }

            .img img {
                max-height: 100px;
            }

            .book-details h5 {
                font-size: 1rem;
            }

            .book-details p {
                font-size: 0.8rem;
            }

            .book-details button {
                font-size: 0.8rem;
            }
        }
        .img img {
            width: 100px;
            height: 150px;
            object-fit: cover;
        }
        .book-details {
            margin-left: 20px;
        }
   </style>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Extract bookId from URL
const urlParams = new URLSearchParams(window.location.search);
const bookId = urlParams.get('bookId');

// Redirect to search page if bookId is missing
if (!bookId) {
    alert('No book selected!');
    window.location.href = 'http://localhost:3000/search';
} else {
    // Fetch book details
    fetch(`/api/book-details/${bookId}`)
        .then((response) => response.json())
        .then((book) => {
            // Populate book details
            document.getElementById('book-title').innerText = book.title;
            document.getElementById('book-author').innerText = book.author;
            document.getElementById('book-image').src = book.image || 'default-book.png';
            document.getElementById('book-genre').innerText = book.genre;
            document.getElementById('book-year').innerText = book.year;
            document.getElementById('book-rack').innerText = book.rack;
            document.getElementById('book-shelf').innerText = book.shelf;
            document.getElementById('book-id').value = book.id;
        })
        .catch((error) => {
            console.error('Error fetching book details:', error);
            alert('Failed to fetch book details.');
        });
}


document.getElementById('borrow-form').addEventListener('submit', function (event) {
    event.preventDefault();

    // Gather form data
    const borrowerName = document.getElementById('borrower-name').value;
    const borrowDate = document.getElementById('borrow-date').value;
    const dueDate = document.getElementById('due-date').value;
    const bookId = document.getElementById('book-id').value;

    // Ensure borrowDate and dueDate are valid before proceeding
    if (!borrowDate || !dueDate) {
        alert('Both Borrow Date and Due Date are required.');
        return;
    }

    // Submit borrow request
    fetch('/api/borrow', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            bookId: bookId,
            borrowerName: borrowerName,
            borrowDate: borrowDate,
            dueDate: dueDate,
        }),
    })
        .then((response) => response.json())
        .then((data) => {
            if (data.message) {
                alert(data.message);
                // Reset form or redirect to another page
                document.getElementById('borrow-form').reset();
            } else {
                alert('An error occurred: ' + data.error);
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('Failed to borrow the book.');
        });
});

// Fetch borrow history
// Fetch borrow history
document.getElementById('fetch-history-btn').addEventListener('click', async () => {
    const username = document.getElementById('username').value.trim();
    const borrowHistoryContainer = document.getElementById('borrow-history-container');
    const noDataMessage = document.getElementById('no-data-message');

    // Clear previous data
    borrowHistoryContainer.innerHTML = '';
    noDataMessage.style.display = 'none';

    // Validate username input
    if (!username) {
        alert('Please enter a username.');
        return;
    }

    try {
        // Fetch borrow history from the backend
        const response = await fetch(`/api/borrow-history?borrower_name=${encodeURIComponent(username)}`);

        // Log response for debugging
        console.log('Response status:', response.status);

        // Check for unsuccessful response
        if (!response.ok) {
            if (response.status === 400) {
                alert('Username is required.');
            } else if (response.status === 404) {
                noDataMessage.style.display = 'block'; // Show "No Data" message
            } else {
                // Log detailed error message in the console
                const errorText = await response.text();
                console.error('Failed to fetch data:', errorText);
                alert('Error: Failed to fetch data. Please try again later.');
            }
            return;
        }

        const historyData = await response.json();

        // Log the data to check if it's being received properly
        console.log('Fetched data:', historyData);

        // Check if historyData is empty
        if (!historyData || historyData.length === 0) {
            noDataMessage.style.display = 'block'; // Show "No Data" message
            return;
        }

        // Populate the borrow history container with books
        historyData.forEach((book) => {
            const bookDiv = document.createElement('div');
            bookDiv.classList.add('div1');
            bookDiv.innerHTML = `
                <div class="img">
                    <img src="${book.image || 'default-book.png'}" alt="Book Image">
                </div>
                <div class="book-details">
                    <h5>${book.book_title || 'Unknown Title'}</h5>
                    <p>Written by ${book.author || 'Unknown Author'}</p>
                    <p>Due Date: <span>${book.due_date ? new Date(book.due_date).toLocaleDateString() : 'N/A'}</span></p>
                    <p>Fine: <span>${book.fine || 'N/A'}</span></p>
                </div>
            `;
            borrowHistoryContainer.appendChild(bookDiv);
        });

    } catch (error) {
        console.error('Error fetching borrow history:', error);
        alert(`Error: ${error.message}`);
    }
});

document.getElementById("logout").addEventListener("click", () => {
    fetch('/logout', {
        method: 'POST',
        credentials: 'include' // Include cookies for session handling
    })
    .then((response) => {
        if (response.ok) {
            // Redirect to login page
            window.location.href = '/login';
        } else {
            return response.json().then((data) => {
                throw new Error(data.message || "Logout failed.");
            });
        }
    })
    .catch((error) => {
        console.error("Error during logout:", error);
        alert("An error occurred while logging out. Please try again.");
    });
});
const containerImg = document.querySelector('.container-img');
const imageWrapper = document.querySelector('.image-wrapper');
const bookImage = document.getElementById('book-image');
const zoomCircle = document.querySelector('.zoom-circle');

// Adjust the position of the zoom circle and background image to create the zoom effect
function zoomImage(event) {
    const containerRect = containerImg.getBoundingClientRect();
    const wrapperRect = imageWrapper.getBoundingClientRect();

    // Calculate the cursor position relative to the container
    const offsetX = event.clientX - containerRect.left;
    const offsetY = event.clientY - containerRect.top;

    // Show the zoom circle
    zoomCircle.style.display = 'block';

    // Position the zoom circle relative to the container
    zoomCircle.style.left = `${offsetX - zoomCircle.offsetWidth / 2}px`;
    zoomCircle.style.top = `${offsetY - zoomCircle.offsetHeight / 2}px`;

    // Update the zoom circle background to reflect the area of the image under the wrapper
    zoomCircle.style.backgroundImage = `url('${bookImage.src}')`;
    zoomCircle.style.backgroundPosition = `-${(offsetX / containerRect.width) * bookImage.naturalWidth}px -${(offsetY / containerRect.height) * bookImage.naturalHeight}px`;
    zoomCircle.style.backgroundSize = `${bookImage.naturalWidth}px ${bookImage.naturalHeight}px`;
}

// Hide the zoom circle
function resetZoom() {
    zoomCircle.style.display = 'none';
}









</script>
</body>
</html>